#
# This is a make file implementing x86_64 (SIMD) probes for applications built using the TxHPC framwework,
# for shared access to Gen-Z-style byte addressable shared memory across nodes
# (as in The Machine).
# See: http://http://genzconsortium.org/
#
#    [HPE copyright notice]
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU Lesser General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU Lesser General Public License for more details.
#
#    You should have received a copy of the GNU Lesser General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
#    As an exception, the copyright holders of this Library grant you permission to
#   (i) compile an #Application with the Library, and
#    (ii) distribute the Application containing code generated by the Library and    
#    added to the Application during this compilation process under terms of your
#    choice, provided you also meet the terms and conditions of the Application license.

noinst_HEADERS += \
 jerasure/include/cauchy.h \
 jerasure/include/galois.h \
 jerasure/include/jerasure.h \
 jerasure/include/liberation.h \
 jerasure/include/reed_sol.h \
 gf-complete/include/gf_int.h \
 gf-complete/include/gf_complete.h \
 gf-complete/include/gf_rand.h \
 gf-complete/include/gf_method.h \
 gf-complete/include/gf_general.h \

jerasure_sources = \
 jerasure/src/cauchy.c \
 jerasure/src/galois.c \
 jerasure/src/jerasure.c \
 jerasure/src/liberation.c \
 jerasure/src/reed_sol.c \
 gf-complete/src/gf_wgen.c \
 gf-complete/src/gf_method.c \
 gf-complete/src/gf_w16.c \
 gf-complete/src/gf.c \
 gf-complete/src/gf_w32.c \
 gf-complete/src/gf_w64.c \
 gf-complete/src/gf_w128.c \
 gf-complete/src/gf_general.c \
 gf-complete/src/gf_w4.c \
 gf-complete/src/gf_rand.c \
 gf-complete/src/gf_w8.c \

r64tm_sources = \
 raid6/src/r6.c \

app_sources = \
 r6_emu.c

libec_jerasure_generic_la_SOURCES = ${jerasure_sources}

CC = gcc

CFLAGS = -O2 -Wall -lm -lpthread  -msse2 -DINTEL_SSE2 -msse3 -DINTEL_SSE3 -mssse3 -DINTEL_SSSE3 -msse4.1 -DINTEL_SSE4 -msse4.2 -DINTEL_SSE4 -mpclmul -DINTEL_SSE4_PCLMUL

SOURCES = \
 $(libec_jerasure_generic_la_SOURCES) \
 $(r64tm_sources) \
 $(app_sources) 

DIREC = \
 -Ijerasure/include \
 -Igf-complete/include \
 -Iraid6/include 

EXECUTABLE = r6_emu

all: $(SOURCES) $(EXECUTABLE)

$(EXECUTABLE):
	$(CC) $(DIREC) $(CFLAGS) $(LDFLAGS) $(SOURCES) -o $@

clean:
	rm $(EXECUTABLE)
